# Web 端日志监控工具 - 技术设计文档

## 1. 项目概述

### 1.1 项目背景
开发一个 Web 端实时日志监控工具，用于展示系统运行状态，处理持续产生的大量日志数据，提供流畅的搜索、过滤和详情查看功能。

### 1.2 核心目标
- 实时数据获取：每 3 秒轮询新日志
- 高性能渲染：支持 5000+ 条日志流畅滚动
- 搜索过滤：支持关键词搜索和级别筛选
- 良好的用户体验：响应式设计，流畅交互

## 2. 技术栈

### 2.1 核心技术
- **框架**: Vue 3.4+ (Composition API, `<script setup>`)
- **语言**: TypeScript 5.0+ (strict mode)
- **构建工具**: Vite 5.0+
- **样式方案**: Tailwind CSS 3.0+
- **状态管理**: Vue 3 响应式 API (ref, reactive, computed)

### 2.2 依赖库
- `vue-virtual-scroller`: 虚拟滚动优化
- `@vueuse/core`: 常用 Composition API 工具集

## 3. 架构设计

### 3.1 项目结构

```
src/
├── types/
│   └── log.ts                  # 日志类型定义
├── api/
│   └── logApi.ts               # API 模拟函数
├── composables/
│   ├── useLogFetcher.ts        # 实时数据获取
│   ├── useLogFilter.ts         # 搜索过滤逻辑
│   └── useDebounce.ts          # 防抖 Hook
├── components/
│   ├── LogList.vue             # 虚拟滚动列表
│   ├── LogItem.vue             # 单条日志组件
│   ├── LogDetail.vue           # 日志详情面板
│   └── LogFilter.vue           # 搜索过滤栏
├── App.vue                     # 主应用组件
└── main.ts                     # 应用入口

docs/
├── 技术设计文档.md
└── 开发计划.md

tests/
└── unit/                       # 单元测试
```

### 3.2 数据流设计

```
API (每3秒) → useLogFetcher → 原始日志列表
                                    ↓
                            useLogFilter (搜索/过滤)
                                    ↓
                            过滤后的日志列表
                                    ↓
                            LogList (虚拟滚动)
                                    ↓
                            LogItem (单条渲染)
                                    ↓
                            LogDetail (详情展示)
```

## 4. 核心功能设计

### 4.1 实时数据获取 (useLogFetcher)

**功能描述**:
- 每 3 秒调用 API 获取 5-10 条新日志
- 将新日志追加到列表顶部
- 支持启动/停止轮询

**接口设计**:
```typescript
interface UseLogFetcherReturn {
  logs: Ref<LogItem[]>
  isLoading: Ref<boolean>
  error: Ref<Error | null>
  startPolling: () => void
  stopPolling: () => void
}
```

**实现要点**:
- 使用 `setInterval` 实现轮询
- 组件卸载时清理定时器
- 使用 `unshift` 将新数据添加到数组头部

### 4.2 高性能列表展示 (LogList)

**性能挑战**:
- 5000+ 条数据的 DOM 渲染会导致严重卡顿
- 需要虚拟滚动技术优化

**解决方案**:
- 使用 `vue-virtual-scroller` 库
- 只渲染可视区域的 DOM 节点（约 20-30 个）
- 滚动时动态更新渲染内容

**配置参数**:
```typescript
{
  itemHeight: 80,        // 单条日志高度
  buffer: 200,           // 缓冲区高度
  poolSize: 50           // 复用池大小
}
```

### 4.3 搜索与过滤 (useLogFilter)

**功能描述**:
- 关键词搜索：根据 message 内容模糊匹配
- 级别过滤：支持多选 INFO/WARN/ERROR/DEBUG
- 500ms 防抖优化

**接口设计**:
```typescript
interface UseLogFilterReturn {
  searchKeyword: Ref<string>
  selectedLevels: Ref<LogLevel[]>
  filteredLogs: ComputedRef<LogItem[]>
  setSearchKeyword: (keyword: string) => void
  toggleLevel: (level: LogLevel) => void
}
```

**实现要点**:
- 使用 `computed` 计算过滤结果
- 使用 `useDebounce` 实现防抖
- 过滤逻辑：先按级别筛选，再按关键词搜索

### 4.4 日志详情展示 (LogDetail)

**功能描述**:
- 点击日志条目显示完整详情
- 侧边栏或抽屉式展示
- 支持关闭操作

**展示内容**:
- ID
- 时间戳（格式化显示）
- 日志级别（带颜色标识）
- 完整消息内容

## 5. 类型定义

### 5.1 核心类型

```typescript
// types/log.ts
export type LogLevel = 'INFO' | 'WARN' | 'ERROR' | 'DEBUG'

export interface LogItem {
  id: string
  timestamp: number
  level: LogLevel
  message: string
}

export interface LogFilterOptions {
  keyword: string
  levels: LogLevel[]
}
```

## 6. 性能优化方案

### 6.1 渲染优化
- ✅ 虚拟滚动：只渲染可视区域
- ✅ 组件懒加载：详情面板按需加载
- ✅ 计算属性缓存：过滤结果自动缓存

### 6.2 搜索优化
- ✅ 防抖处理：500ms 延迟执行
- ✅ 索引优化：考虑使用 Map 结构加速查找

### 6.3 内存优化
- ⚠️ 数据上限：考虑设置最大日志数量（如 10000 条）
- ⚠️ 自动清理：超过上限时删除旧数据

## 7. 用户体验设计

### 7.1 视觉设计
- 日志级别颜色：
  - INFO: 蓝色
  - WARN: 黄色
  - ERROR: 红色
  - DEBUG: 灰色

### 7.2 交互设计
- 列表滚动流畅，无卡顿
- 搜索输入即时反馈
- 详情面板平滑展开/收起
- 加载状态提示

## 8. 开发规范

### 8.1 代码规范
- 使用 ESLint + Prettier
- 遵循 Vue 3 官方风格指南
- TypeScript strict 模式

### 8.2 Git 规范
- 遵循 Conventional Commits
- 提交格式：`<type>(<scope>): <subject>`
- 类型：feat, fix, docs, style, refactor, test, chore

### 8.3 测试规范
- 单元测试：Composables 和工具函数
- 组件测试：关键交互逻辑
- 覆盖率目标：> 70%

## 9. 部署方案

### 9.1 构建配置
- 生产环境优化：代码分割、压缩、Tree Shaking
- 静态资源 CDN 加速

### 9.2 运行环境
- Node.js 18+
- 现代浏览器（Chrome 90+, Firefox 88+, Safari 14+）

## 10. 风险与挑战

### 10.1 技术风险
- 虚拟滚动库兼容性问题
- 大数据量下的内存占用

### 10.2 解决方案
- 充分测试虚拟滚动性能
- 实现数据上限和自动清理机制
